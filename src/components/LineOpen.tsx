/* eslint-disable max-len */
import {useEffect, useState} from 'react';
import style from '../style/LineOpen.module.scss';
import {supabase} from '../utils/client';

export default function LineOpen() {
  const [isOpen, setIsOpen] = useState(false);

  const handleTableEvent = (payload: any) => {
    console.log(payload);
    if (payload.new && payload.new.name === 'linesOpen') {
      console.log(payload.new);
      if (payload.new.value?.value === true || payload.new.value?.value === false) {
        setIsOpen(payload.new.value.value);
      } else {
        setIsOpen(false);
      }
    }
  };

  useEffect(() => {
    const channel = supabase
      .channel('table-db-changes')
      .on('postgres_changes', {
        event: 'UPDATE',
        schema: 'public',
        table: 'settings',
      }, (payload) => handleTableEvent(payload))
      .subscribe();
    return () => {
      channel.unsubscribe();
    };
  });

  // run once to get initial value
  useEffect(() => {
    const fetchIsOpen = async () => {
      const {data, error} = await supabase.from('settings').select('*').eq('name', 'linesOpen');
      if (error) {
        console.log(error);
      } else if (data[0].value?.value === true || data[0].value?.value === false) {
        setIsOpen(data[0].value?.value ?? false);
      }
    };
    fetchIsOpen();
  }, []);

  return (
    <div
      className={`text-white mr-20 min-h-[400px] min-w-[400px] ${style.container} ${isOpen ? style.visible : style.hidden}`}
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        xmlSpace="preserve"
        fillRule="evenodd"
        strokeLinejoin="round"
        strokeMiterlimit="2"
        clipRule="evenodd"
        viewBox="0 0 4267 4267"
      >
        <path
          fill="#fff"
          className={style.star}
          d="M1947.33 708.557c68.754-165.285 303.253-165.285 372.007 0l319.52 768.414 829.341 66.451c178.636 14.273 251.073 237.108 114.947 353.744l-631.827 541.282 192.909 809.236c41.59 174.34-147.943 312.001-300.797 218.692l-710.097-433.7-710.096 433.7c-152.854 93.309-342.387-44.506-300.797-218.692l192.909-809.236-631.828-541.282c-136.126-116.636-63.689-339.471 114.948-353.744l829.341-66.451 319.52-768.261v-.153Z"
        />
        <path
          fill="#fff"
          fillRule="nonzero"
          className={style.text}
          d="m495.1838 3349.955055-309.671027-59.486277 21.356265-111.1755 224.601516 43.144843 38.562325-200.746044 85.069512 16.341434-59.91859 311.921544ZM272.676735 2908.19997l38.002732-106.639023 297.03501 105.853762-38.00273 106.639023zM616.494413 2857.473864l-271.896047-159.710086 49.909402-84.967515 192.348248-67.743984c2.11414-.88438 5.48295-2.094883 9.874291-3.23631 4.391342-1.141427 9.01482-2.678052 13.638298-4.214677 4.623478-1.536624 9.01482-2.678051 13.010964-4.051615l2.321367-3.951977-135.552826-79.622907 53.855727-91.685876 271.896047 159.710086-49.445128 84.17712-182.07876 64.73981c-7.59709 2.979264-16.216712 5.889453-25.463668 8.962702-9.01482 2.678052-16.379773 5.262118-22.025783 6.729667l-2.089231 3.55678 135.552826 79.622906-53.855727 91.685876ZM617.2675 2278.915708l74.384662-85.340494 237.709554 207.192904-74.384662 85.340494zM959.149072 2358.614437l-199.468826-244.227484 260.911628-213.09533 49.577281 60.701889-172.87614 141.193777 25.80338 31.59338 149.09236-121.76876 46.96795 57.507053-149.09236 121.76876 27.542935 33.723272 175.715994-143.513182 49.577281 60.70189-263.751483 215.414735ZM1540.828177 1995.733903c-40.199658 15.49692-77.147841 22.863467-111.437066 21.836845-34.289225-1.026623-63.714285-9.822891-88.27518-26.388804-24.396035-16.138257-43.072593-40.375881-55.272297-72.02242-12.199704-31.64654-14.625336-62.148877-7.539692-90.914494 7.085644-28.765616 22.992114-55.037136 47.719409-78.814557 24.892156-23.349766 57.224235-42.690679 97.423893-58.1876 40.627315-15.661782 77.575498-23.028328 111.699862-22.429361 33.861569 1.191483 63.28663 9.987751 87.847525 26.553664 24.560895 16.565913 43.237453 40.803537 55.437157 72.450077 12.199703 31.64654 14.460475 61.72122 7.37483 90.486837-7.085644 28.765616-22.992113 55.037136-47.291752 78.649696-24.727295 23.777422-57.059374 43.118335-97.686689 58.780117Zm-28.191207-73.129166c13.257334-5.110687 24.999913-11.602275 34.207564-19.5727 9.372512-7.54277 16.802612-16.30158 21.862645-26.11157 5.224894-9.382335 8.079721-19.81585 8.466546-30.280372.386826-10.464523-1.431555-21.55257-5.553077-32.243968l-3.95666-10.263743c-4.121522-10.691398-10.216462-20.130837-17.527444-27.627864-7.310981-7.497027-16.26566-12.886782-26.43638-16.334125-10.17072-3.447344-21.55748-4.952276-33.567766-4.252002-12.175147.272618-25.236612 3.34296-38.493946 8.453646-13.257335 5.110687-24.999913 11.602275-34.207564 19.5727-9.372512 7.54277-16.802612 16.30158-22.027506 25.683914-5.224894 9.382335-8.244582 19.388194-8.631407 29.852716-.386826 10.464523 1.431555 21.55257 5.553077 32.243968l3.95666 10.263743c4.121522 10.691398 10.216462 20.130837 17.527444 27.627864 7.310982 7.497027 16.430521 13.314437 26.60124 16.761781 10.335582 3.875 21.722343 5.379932 33.732628 4.679658 12.175146-.272618 25.236612-3.34296 38.493946-8.453646ZM1862.812353 1901.587913l-29.32951-226.819526-132.728059 17.16276-11.108772-85.9096 377.72951-48.843333 11.108773 85.9096-132.72806 17.16276 29.32951 226.819525-112.273392 14.517814ZM2186.870427 1870.92417l-46.572258-325.326613 114.31444 16.504808 17.2215 143.727375c1.220219 7.585536 1.98681 15.105577 2.365266 22.106494.378457 7.000917.82241 13.548205 1.331858 19.641864.574942 5.64003.827247 10.307309.82241 13.548205l3.1754.458467 8.723147-25.13639c1.627705-4.858925 3.189915-9.264222 5.27125-14.057652 2.081334-4.79343 3.578049-8.745099 5.074763-12.696767l55.359099-133.248132 136.542248 19.714076 14.953355 143.3999c.574943 5.64003 1.084391 11.73369 1.462848 18.734606l1.331857 19.641864c.443953 6.547288.565267 12.121824.817572 16.789102l3.175401.458466c.97759-3.563534 2.474306-7.515202 4.036516-11.920499 2.015839-4.339801 3.578049-8.745098 5.205754-13.604024 2.081335-4.79343 3.643545-9.198727 5.659384-13.538528 2.081334-4.79343 3.578049-8.745099 5.074764-12.696767l57.627242-132.920656 103.88098 14.998417-136.69375 298.866524-128.83056-18.600657-19.562575-182.038351c-.640438-5.186402-1.215381-10.826433-1.85582-16.012835-.640438-5.186402-.827247-10.307308-1.145047-14.520957-.3178-4.21365-.701096-7.97367-.827248-10.307309l-3.175401-.458467c-1.43122 3.49804-2.927935 7.449708-5.009269 12.243138l-10.215023 25.847161-70.709543 169.004793-128.83056-18.600657ZM2596.978901 1931.77829l266.041936-227.927303 114.253077 49.879553 13.710084 350.058852-111.31274-48.595887-.534327-45.742984-141.556203-61.799298-33.489567 30.889147-107.11226-46.76208Zm203.463534-42.201735 78.54899 34.292192 1.109855-57.527851c.076807-2.467002.283709-6.377529.67399-10.708104.206902-3.910526.543898-9.264578.880893-14.61863l2.678688-31.3375-2.940336-1.283665c-3.69738 3.887006-8.18157 8.430727-13.03252 13.814545-4.850952 5.383818-9.518522 10.347587-14.186092 15.311357-4.66757 4.96377-8.96838 9.087443-12.298998 12.134353l-41.43447 39.923303ZM3000.76319 2112.878996l195.074664-247.751327 214.62179 168.989097c18.365287 14.460477 30.730819 30.613784 37.380133 48.099817 6.289211 17.202495 7.712822 34.657406 3.910728 52.081193-3.802094 17.423787-11.052095 33.299472-22.393645 47.70362-13.042783 16.564768-28.268909 28.493631-45.678377 35.786588-17.486034 6.649315-36.511768 8.586159-56.510125 5.090325l-22.477667 129.307396-100.468925-79.107312 23.51005-106.91032-77.062186-60.677294-60.960832 77.42229-88.945607-70.034073Zm198.391568-68.965945 94.347162 74.287153c6.84197 5.387237 13.944758 7.479696 21.745032 7.20456 8.083812-.635241 14.781055-4.695667 20.735368-12.257844 3.969543-5.041452 6.291697-10.213312 6.682924-15.155478.674765-5.30227-.221293-10.091305-2.044532-14.443672-2.183343-4.635906-5.293867-8.835143-9.975215-12.521147l-94.347163-74.287154-37.143576 47.173582ZM3384.100161 2453.050346l178.707603-142.726808-83.519495-104.57439 67.686848-54.05885 237.68733 297.60725-67.686848 54.058851-83.519495-104.574389-178.707603 142.726808-70.64834-88.458472ZM3547.547588 2665.256427l285.529146-133.820315 142.96211 305.034771-70.967273 33.260573-94.724555-202.111474-36.936183 17.311058 81.692634 174.305583-67.232153 31.510016-81.692634-174.305583-39.426263 18.478096 96.280604 205.43158-70.967273 33.260573-144.51816-308.354878ZM3819.828847 2990.963419l178.284602-70.403872 33.501046 119.604982-188.91593 32.448047-22.869718-81.649157Zm-124.743892 16.853487 90.91744-25.46574 32.264844 115.191514-90.91744 25.46574-32.264844-115.191514ZM3863.658434 3166.17912l184.709884-51.22804 20.713073 122.468849-191.283037 12.363387-14.13992-83.604196Zm-125.82518 3.616752 93.094402-15.744993 19.948753 117.949702-93.094401 15.744993-19.948753-117.949702Z"
        />
      </svg>
    </div>
  );
}
